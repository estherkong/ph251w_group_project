---
title: "Milestone #4 for Infectious Disease Outbreak"
author: "Carli Boyd, Esther Kong, Pamela Pichon"
date: Nobember 20, 2025
format: html
editor: visual
---

------------------------------------------------------------------------

```{r}

#Load required packages
library(tidyverse)
library(readr)
library(readxl)
library(tidyr)
library(ggplot2)
library(dplyr)
library(sf)
install.packages("maps")
library(maps)
install.packages("formattable")
library(formattable)
```

# Milestone #4

```{r}
# import clean datasets 
data_file <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/ca_pop_clean.csv"
ca_pop_clean <- read_csv(data_file)

data_file1 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/la_county_clean.csv"
la_county_clean <- read_csv(data_file1)

data_file2 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/novelid_clean.csv"
novelid_clean <- read_csv(data_file2)

data_file3 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/Stratified_morbidity_infections.csv"
stratified_morbidity_infections <- read_csv(data_file3)

data_file4 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/stratified_rate_infections.csv"
stratified_rate_infections <- read_csv(data_file4)

data_file5 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/stratified_ca_pop.csv"
stratified_ca_pop <- read_csv(data_file5)

data_file6 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/summary_table.csv"
summary_table <- read_csv(data_file6)

data_file7 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/data_dictionary.csv"
data_dictionary <- read_csv(data_file7)

data_file8 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/all_three_joined.csv"
all_three_joined <- read_csv(data_file8)

data_file9 <- "https://raw.githubusercontent.com/estherkong/ph251w_group_project/refs/heads/main/morbidity_combined.csv"
morbidity_combined <- read_csv(data_file9)
```

```{r}

# map of new infections by county


ca_counties <- map_data("county") %>%
  filter(region == "california")

stratified_rate_infections <- stratified_rate_infections %>%
  mutate(county = str_to_lower(county))

map_data <- ca_counties %>%
  left_join(stratified_rate_infections, by = c("subregion" = "county"))

# map
ggplot(map_data, aes(long, lat, group = group, fill = new_infections_per_capita)) +
  geom_polygon(color = "white") +
  scale_fill_viridis_c(option = "magma", limits = c(0,50), na.value = "grey") +
  labs(title = "Heat Map of New Infections per Capita by County, 2023", fill = "Infection Rate") +
  theme_void() + 
  theme(
  plot.title = element_text(hjust = 0.5, margin = margin(b = 10)),
  legend.position = "right",
  legend.title = element_text(size = 10),
  legend.text = element_text(size = 8),
  plot.margin = margin(t = 20, r = 20, b = 20, l = 20)
)




summary(map_data$new_infections_per_capita)

```

```{r}

#table 

race_infections_tbl <- stratified_rate_infections %>%
  pivot_wider(
    id_cols = county,
    names_from = race_ethnicity,
    values_from = c("new infections", "pop")
  )
#renaming columns 

colnames(race_infections_tbl) <- c("County", "American Indian or Alaska Native Non-Hispanic", "Asian Non-Hispanic", "Black Non-Hispanic", "Hispanic (Any Race)", "Multiracial (Two or More of Above Races)", "Native Hawaiian or Pacific Islander Non-Hispanic", "White Non-Hispanic", "American Indian or Alaska Native Non-Hispanic Pop", "Asian Non-Hispanic Pop",  "Black Non-Hispanic Pop", "Hispanic (Any Race) Pop", "Multiracial (Two or More of Above Races) Pop", "Native Hawaiian or Pacific Islander Non-Hispanic Pop", "White Non-Hispanic Pop") 

#rearrange the columns 

race_infections_clean <- race_infections_tbl %>%
  select(County, `American Indian or Alaska Native Non-Hispanic`, `American Indian or Alaska Native Non-Hispanic Pop`,`Asian Non-Hispanic`, `Asian Non-Hispanic Pop`, `Black Non-Hispanic`, `Black Non-Hispanic Pop`,`Hispanic (Any Race)`, `Hispanic (Any Race) Pop`, `Multiracial (Two or More of Above Races)`,`Multiracial (Two or More of Above Races) Pop`, `Native Hawaiian or Pacific Islander Non-Hispanic`, `Native Hawaiian or Pacific Islander Non-Hispanic Pop`, `White Non-Hispanic`, `White Non-Hispanic Pop`)

#add column of urban / rural? 

#add rates ?

#table attempt - will continue working on this - 

as.datatable(
  formattable(race_infections_clean, 
    align = c("l", rep("r", NCOL(race_infections_clean)))
  ),
  options = list(pageLength = 10),
  caption = "New Infection Cases by Race/Ethnicity over Population"
)
```
